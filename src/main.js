function _0x4550(_0x81b0b8,_0x559e9e){const _0x5f0d52=_0x5f0d();return _0x4550=function(_0x45502f,_0x12e3e4){_0x45502f=_0x45502f-0xd9;let _0x4c0961=_0x5f0d52[_0x45502f];return _0x4c0961;},_0x4550(_0x81b0b8,_0x559e9e);}const _0x27bfd3=_0x4550;(function(_0x381d48,_0x2ab916){const _0x318ce9=_0x4550,_0x1ca561=_0x381d48();while(!![]){try{const _0x1907ff=-parseInt(_0x318ce9(0x148))/0x1*(-parseInt(_0x318ce9(0x12a))/0x2)+-parseInt(_0x318ce9(0xec))/0x3+-parseInt(_0x318ce9(0x136))/0x4*(parseInt(_0x318ce9(0x125))/0x5)+-parseInt(_0x318ce9(0xee))/0x6*(-parseInt(_0x318ce9(0x110))/0x7)+parseInt(_0x318ce9(0x104))/0x8+-parseInt(_0x318ce9(0x13b))/0x9*(-parseInt(_0x318ce9(0x10e))/0xa)+parseInt(_0x318ce9(0x117))/0xb*(parseInt(_0x318ce9(0xdf))/0xc);if(_0x1907ff===_0x2ab916)break;else _0x1ca561['push'](_0x1ca561['shift']());}catch(_0x572699){_0x1ca561['push'](_0x1ca561['shift']());}}}(_0x5f0d,0x4bc84));const express=require(_0x27bfd3(0x11e)),app=express(),http=require(_0x27bfd3(0x135))[_0x27bfd3(0x13d)](app),io=require(_0x27bfd3(0x141))(http,{'cors':{'origin':'*'}}),DB=require(_0x27bfd3(0xff)),shuffle=require(_0x27bfd3(0x120)),pickPicture=require(_0x27bfd3(0x151)),{v4:uuidv4}=require(_0x27bfd3(0x101));function _0x5f0d(){const _0x3086b5=['express','listen','./shuffle.js','PORT','@alive','messages','@messageReacted','1195EdvMsV','conversations','@usersAvailable','NOT_VALID_USERNAME','password','224012cmjPTt','participants','username','type','RAINBOW','@replyMessage','RED','HAPPY','toLowerCase','last_activity_at','one_to_one','http','8684MbSVNM','map','@conversationTitleSet','@setConversationTitle','updated_at','3555weccWg','data','createServer','@addParticipant','@typeConversation','env','socket.io','@conversationTyped','log','BLUE','random','stringify','inform','3iifOYe','@getUsers','NOT_FOUND_MESSAGE','picture_url','emit','length','@removeParticipant','content','NOT_VALID_CONTENT','./picture.js','public','now','NOT_FOUND_PARTICIPANT','@setConversationTheme','seen','theme','397092MPbcbs','connection','NOT_FOUND_CONVERSATION','trim','@participantRemoved','@seeConversation','use','edited','delivered_to','NOT_AUTHENTICATED','socket@connect','@conversationSeen','from','304023nadXmh','typing','103386NvsglG','HEART','@participantAdded','@conversationCreated','static','find','SUCCESS','token','@messagePosted','@postMessage','expire_at','NOT_VALID_USER','user_username','@conversationThemeSet','@participantNicknameSet','isArray','includes','./db.js','sessions','uuid','filter','get','979360RGzTcG','Server\x20is\x20listening\x20on\x20ws://localhost:','@setParticipantNickname','sync','socket@authenticate','createManyToManyConversation','@editMessage','@authenticate','NOT_FOUND_THEME','many_to_many','1990BzskWy','@userCreated','133zoQcpG','nicknames','THUMB','NOT_FOUND_USER','socket_id','some','@createManyToManyConversation','22rfmvUv','users','@searchMessage','@messageDelivered','@messageDeleted','push','NOT_VALID_PASSWORD'];_0x5f0d=function(){return _0x3086b5;};return _0x5f0d();}app[_0x27bfd3(0xe5)](express[_0x27bfd3(0xf2)](_0x27bfd3(0xd9)));let db=new DB({'sessions':[],'users':[],'conversations':[]}),data=db[_0x27bfd3(0x13c)];db[_0x27bfd3(0x107)](),app[_0x27bfd3(0x103)]('/',(_0x43d4d3,_0x103bb0)=>{const _0x2a664d=_0x27bfd3;_0x103bb0['send'](JSON[_0x2a664d(0x146)](data,null,0x4));});let sockets={};function getUserByUsername(_0x3766ed){const _0x5122ab=_0x27bfd3;return data['users']['find'](_0x242e68=>_0x242e68[_0x5122ab(0x12c)]===_0x3766ed);}function inform(_0x5a8417,_0x29d433,_0x203347,_0x241ec7=()=>{}){const _0x2975ed=_0x27bfd3;let _0x4851fb=data[_0x2975ed(0x100)]['filter'](_0x57d746=>_0x57d746[_0x2975ed(0xfa)]===_0x5a8417),_0x4d3f53=_0x4851fb['map'](_0x3562d9=>_0x3562d9[_0x2975ed(0x114)]),_0x100b60=_0x4d3f53[_0x2975ed(0x137)](_0x13a467=>sockets[_0x13a467])['filter'](_0x56f61d=>_0x56f61d);if(_0x29d433===_0x2975ed(0x11b))console['log'](_0x29d433,_0x5a8417,_0x4d3f53,Object['keys'](sockets));for(let _0x391c69 of _0x100b60){try{if(_0x29d433===_0x2975ed(0x11b))console[_0x2975ed(0x143)](_0x2975ed(0x147),_0x5a8417,_0x29d433,_0x203347);_0x391c69[_0x2975ed(0x14c)](_0x29d433,_0x203347,_0x241ec7);}catch(_0x32fe83){}}}let activeUsers=[];function isUserAwake(_0x189d36){const _0x39f349=_0x27bfd3;return new Date(Date['now']()-0x4e20)<new Date(_0x189d36[_0x39f349(0x133)]);}setInterval(()=>{const _0x1e13ee=_0x27bfd3;inform('a',_0x1e13ee(0x122),{'time':Date[_0x1e13ee(0xda)]()});},0x7d0),setInterval(()=>{const _0x522f9a=_0x27bfd3;let _0xd0a111=data[_0x522f9a(0x118)][_0x522f9a(0x102)](_0x17f6b9=>isUserAwake(_0x17f6b9))[_0x522f9a(0x137)](_0x472fa2=>_0x472fa2[_0x522f9a(0x12c)]),_0x327175=_0xd0a111[_0x522f9a(0x102)](_0x21ec0d=>!activeUsers[_0x522f9a(0xfe)](_0x21ec0d)),_0x27fb9c=activeUsers['filter'](_0x3ddc8e=>!_0xd0a111['includes'](_0x3ddc8e));if(_0x327175[_0x522f9a(0x14d)]>0x0||_0x27fb9c['length']>0x0)for(let _0x4b9485 of data[_0x522f9a(0x118)]){inform(_0x4b9485[_0x522f9a(0x12c)],_0x522f9a(0x127),{'usernames':_0xd0a111});}activeUsers=_0xd0a111;},0x3e8),io['on'](_0x27bfd3(0xe0),_0x5ccd09=>{const _0x24c28f=_0x27bfd3;sockets[_0x5ccd09['id']]=_0x5ccd09;function _0x56c64f(_0x20b823){const _0x1fd2d6=_0x4550;let _0x4cfe9b=data[_0x1fd2d6(0x100)][_0x1fd2d6(0xf3)](_0xba9916=>_0xba9916['token']===_0x20b823);data[_0x1fd2d6(0x100)]=data[_0x1fd2d6(0x100)][_0x1fd2d6(0x102)](_0x21acba=>new Date()<new Date(_0x21acba[_0x1fd2d6(0xf8)]));let _0x3aca62=data[_0x1fd2d6(0x100)][_0x1fd2d6(0xf3)](_0x125fb7=>_0x125fb7[_0x1fd2d6(0xf5)]===_0x20b823);if(_0x3aca62)return getUserByUsername(_0x3aca62['user_username']);return undefined;}console[_0x24c28f(0x143)](_0x24c28f(0xe9),_0x5ccd09['id']),_0x5ccd09['on'](_0x24c28f(0x10b),({username:_0x1bf635,password:_0x5cd6f0},_0x1d1a8b)=>{const _0x54b4af=_0x24c28f;console[_0x54b4af(0x143)](_0x54b4af(0x108),_0x5ccd09['id'],_0x1bf635,_0x5cd6f0);let _0x3b70ef=Date[_0x54b4af(0xda)]()+String(Math[_0x54b4af(0x145)]()),_0x1ee193={'token':_0x3b70ef,'socket_id':_0x5ccd09['id'],'user_username':_0x1bf635,'expire_at':new Date(Date[_0x54b4af(0xda)]()+0x18*0x3c*0x3c*0x3e8)},_0x21ad9d=data[_0x54b4af(0x118)][_0x54b4af(0xf3)](_0x186c64=>_0x186c64['username']===_0x1bf635);if(_0x21ad9d){if(_0x21ad9d[_0x54b4af(0x129)]!==_0x5cd6f0)return _0x1d1a8b({'code':'NOT_AUTHENTICATED'});return data[_0x54b4af(0x100)][_0x54b4af(0x11c)](_0x1ee193),console[_0x54b4af(0x143)]({'newSession':_0x1ee193}),db[_0x54b4af(0x107)](),_0x1d1a8b({'code':_0x54b4af(0xf4),'data':{'username':_0x1bf635,'token':_0x1ee193[_0x54b4af(0xf5)],'picture_url':_0x21ad9d[_0x54b4af(0x14b)]}});}if(!_0x1bf635||_0x1bf635['includes']('-'))return _0x1d1a8b({'code':_0x54b4af(0x128)});if(!_0x5cd6f0)return _0x1d1a8b({'code':_0x54b4af(0x11d)});let _0xe5991={'username':_0x1bf635,'password':_0x5cd6f0,'picture_url':pickPicture(data['users']),'last_activity_at':new Date()};data[_0x54b4af(0x118)][_0x54b4af(0x11c)](_0xe5991),data['sessions'][_0x54b4af(0x11c)](_0x1ee193);for(let _0x184b07 of data['users']){inform(_0x184b07[_0x54b4af(0x12c)],_0x54b4af(0x10f),{'user':{..._0xe5991,'password':undefined}});}return db['sync'](),_0x1d1a8b({'code':_0x54b4af(0xf4),'data':{'username':_0x1bf635,'token':_0x3b70ef,'picture_url':_0xe5991[_0x54b4af(0x14b)]}});}),_0x5ccd09['on'](_0x24c28f(0x149),({token:_0xe8810},_0x384482)=>{const _0x478c44=_0x24c28f;let _0x6035e1=_0x56c64f(_0xe8810);if(!_0x6035e1)return _0x384482({'code':'NOT_AUTHENTICATED'});_0x6035e1[_0x478c44(0x133)]=new Date(),db[_0x478c44(0x107)]();let _0x469b0c=data[_0x478c44(0x118)]['map'](_0x2e2276=>({'username':_0x2e2276[_0x478c44(0x12c)],'picture_url':_0x2e2276[_0x478c44(0x14b)],'awake':isUserAwake(_0x2e2276)}));return _0x384482({'code':_0x478c44(0xf4),'data':{'users':_0x469b0c}});}),_0x5ccd09['on']('@getOrCreateOneToOneConversation',({token:_0x3d1ca3,username:_0x2b1df0},_0x35aee7)=>{const _0x43df60=_0x24c28f;console['log']('getOrCreateOneToOneConversation');let _0x2d887e=_0x56c64f(_0x3d1ca3);if(!_0x2d887e)return _0x35aee7({'code':_0x43df60(0xe8)});_0x2d887e[_0x43df60(0x133)]=new Date(),db['sync']();let _0xb4e725=getUserByUsername(_0x2b1df0);if(!_0xb4e725)return _0x35aee7({'code':'NOT_FOUND_USER'});let _0x559ab3=data['conversations'][_0x43df60(0xf3)](_0x3e6156=>_0x3e6156[_0x43df60(0x12d)]===_0x43df60(0x134)&&_0x3e6156[_0x43df60(0x12b)][_0x43df60(0x14d)]===0x2&&_0x3e6156['participants'][_0x43df60(0xfe)](_0x2d887e['username'])&&_0x3e6156[_0x43df60(0x12b)]['includes'](_0xb4e725[_0x43df60(0x12c)]));const _0x34f2c8=new Date();if(!_0x559ab3){let _0x2c636f=[_0x2d887e[_0x43df60(0x12c)],_0xb4e725[_0x43df60(0x12c)]],_0x1cae93={};for(let _0x18d82a of _0x2c636f){_0x1cae93[_0x18d82a]=-0x1;}_0x559ab3={'id':uuidv4(),'type':'one_to_one','participants':_0x2c636f,'messages':[],'title':null,'theme':_0x43df60(0x144),'nicknames':{},'updated_at':_0x34f2c8,'seen':_0x1cae93,'typing':{}},data[_0x43df60(0x126)][_0x43df60(0x11c)](_0x559ab3),db[_0x43df60(0x107)]();for(let _0x54e0db of _0x559ab3[_0x43df60(0x12b)]){inform(_0x54e0db,_0x43df60(0xf1),{'conversation':_0x559ab3});}}return _0x35aee7({'code':_0x43df60(0xf4),'data':{'conversation':_0x559ab3}});}),_0x5ccd09['on'](_0x24c28f(0x116),({token:_0x2ce10c,usernames:_0x5b7791},_0x513ca6)=>{const _0x3bd602=_0x24c28f;let _0x376940=_0xdb5b46=>setTimeout(_0x58b506=>_0x513ca6(_0x58b506),0x7d0,_0xdb5b46);console['log'](_0x3bd602(0x109));let _0x4d0ee9=_0x56c64f(_0x2ce10c);if(!_0x4d0ee9)return _0x376940({'code':_0x3bd602(0xe8)});if(!Array[_0x3bd602(0xfd)](_0x5b7791))return _0x376940({'code':'NOT_VALID_USERNAMES'});_0x4d0ee9[_0x3bd602(0x133)]=new Date(),db['sync'](),_0x5b7791=[...new Set([_0x4d0ee9[_0x3bd602(0x12c)],..._0x5b7791])];if(_0x5b7791[_0x3bd602(0x115)](_0x16954b=>!getUserByUsername(_0x16954b)))return _0x376940({'code':_0x3bd602(0x113)});const _0x2c188a=new Date();let _0x40c73e={};for(let _0x1edd7c of _0x5b7791){_0x40c73e[_0x1edd7c]=-0x1;}let _0x431b0f={'id':uuidv4(),'type':_0x3bd602(0x10d),'participants':_0x5b7791,'messages':[],'title':null,'theme':_0x3bd602(0x144),'nicknames':{},'seen':_0x40c73e,'updated_at':_0x2c188a,'typing':{}};data[_0x3bd602(0x126)][_0x3bd602(0x11c)](_0x431b0f),db[_0x3bd602(0x107)]();for(let _0x5eb095 of _0x431b0f[_0x3bd602(0x12b)]){inform(_0x5eb095,_0x3bd602(0xf1),{'conversation':_0x431b0f});}return _0x376940({'code':_0x3bd602(0xf4),'data':{'conversation':_0x431b0f}});}),_0x5ccd09['on']('@postMessage',({token:_0x3a30d0,conversation_id:_0x1dba52,content:_0x21d623},_0x4f4db9)=>{const _0x3176b9=_0x24c28f;console[_0x3176b9(0x143)](_0x3176b9(0xf7));let _0xc657bd=_0x56c64f(_0x3a30d0);if(!_0xc657bd)return _0x4f4db9({'code':_0x3176b9(0xe8)});_0x21d623=String(_0x21d623)['trim']();if(!_0x21d623[_0x3176b9(0x14d)])return _0x4f4db9({'code':_0x3176b9(0x150)});_0xc657bd[_0x3176b9(0x133)]=new Date(),db[_0x3176b9(0x107)]();let _0x2d1e3f=data[_0x3176b9(0x126)]['find'](_0x14cbab=>_0x14cbab['id']===_0x1dba52&&_0x14cbab[_0x3176b9(0x12b)][_0x3176b9(0xfe)](_0xc657bd[_0x3176b9(0x12c)]));if(!_0x2d1e3f)return _0x4f4db9({'code':_0x3176b9(0xe1)});const _0x47a6c4=new Date(),_0x176728=uuidv4();let _0x4387ff={'id':_0x176728,'from':_0xc657bd[_0x3176b9(0x12c)],'content':_0x21d623,'posted_at':_0x47a6c4,'delivered_to':{[_0xc657bd[_0x3176b9(0x12c)]]:_0x47a6c4},'reply_to':null,'edited':![],'deleted':![],'reactions':{}};_0x2d1e3f['messages']['push'](_0x4387ff),_0x2d1e3f[_0x3176b9(0x13a)]=_0x47a6c4,_0x2d1e3f[_0x3176b9(0xdd)][_0xc657bd['username']]={'message_id':_0x176728,'time':_0x47a6c4},db[_0x3176b9(0x107)]();for(let _0x5cf6fc of _0x2d1e3f[_0x3176b9(0x12b)]){inform(_0x5cf6fc,_0x3176b9(0xea),{'conversation':_0x2d1e3f});}for(let _0x2e6456 of _0x2d1e3f['participants']){inform(_0x2e6456,'@messagePosted',{'conversation_id':_0x2d1e3f['id'],'message':_0x4387ff},()=>{const _0x3820a5=_0x3176b9,_0x571ae4=new Date();_0x4387ff['delivered_to'][_0x2e6456]=_0x571ae4,db[_0x3820a5(0x107)]();for(let _0x4f0cd7 of _0x2d1e3f[_0x3820a5(0x12b)]){inform(_0x4f0cd7,'@messageDelivered',{'conversation_id':_0x2d1e3f['id'],'message':_0x4387ff});}});}return _0x4f4db9({'code':_0x3176b9(0xf4),'data':{'message':_0x4387ff}});}),_0x5ccd09['on'](_0x24c28f(0xe4),({token:_0x2c3d4a,conversation_id:_0x1c1db4,message_id:_0x2f4c7f},_0x16fb88)=>{const _0x39de6f=_0x24c28f;let _0x1cab6f=_0x56c64f(_0x2c3d4a);if(!_0x1cab6f)return _0x16fb88({'code':_0x39de6f(0xe8)});let _0x2dcb7e=data['conversations'][_0x39de6f(0xf3)](_0x526bef=>_0x526bef['id']===_0x1c1db4&&_0x526bef['participants'][_0x39de6f(0xfe)](_0x1cab6f[_0x39de6f(0x12c)]));if(!_0x2dcb7e)return _0x16fb88({'code':_0x39de6f(0xe1)});let _0x4713f1=_0x2dcb7e['messages'][_0x39de6f(0xf3)](_0x21ac1e=>_0x21ac1e['id']===_0x2f4c7f);if(!_0x4713f1)return _0x16fb88({'code':_0x39de6f(0x14a)});const _0x4c0401=new Date();_0x2dcb7e[_0x39de6f(0xdd)][_0x1cab6f[_0x39de6f(0x12c)]]={'message_id':_0x2f4c7f,'time':_0x4c0401},db['sync']();for(let _0x572a96 of _0x2dcb7e[_0x39de6f(0x12b)]){inform(_0x572a96,'@conversationSeen',{'conversation':_0x2dcb7e});}return _0x16fb88({'code':_0x39de6f(0xf4),'data':{}});}),_0x5ccd09['on']('@reactMessage',({token:_0x13d5d6,conversation_id:_0x37b807,message_id:_0x10a24b,reaction:_0x312598},_0x43808e)=>{const _0x3c5061=_0x24c28f;let _0x5426d2=_0x56c64f(_0x13d5d6);if(!_0x5426d2)return _0x43808e({'code':'NOT_AUTHENTICATED'});let _0x2c458b=data[_0x3c5061(0x126)]['find'](_0x4ed037=>_0x4ed037['id']===_0x37b807&&_0x4ed037['participants'][_0x3c5061(0xfe)](_0x5426d2['username']));if(!_0x2c458b)return _0x43808e({'code':_0x3c5061(0xe1)});let _0x8a7cdc=_0x2c458b[_0x3c5061(0x123)]['find'](_0x111b5f=>_0x111b5f['id']===_0x10a24b);if(!_0x8a7cdc)return _0x43808e({'code':_0x3c5061(0x14a)});if(![_0x3c5061(0xef),_0x3c5061(0x112),_0x3c5061(0x131),'SAD'][_0x3c5061(0xfe)](_0x312598))return _0x43808e({'code':'NOT_FOUND_REACTION'});const _0x865b7e=new Date();_0x2c458b[_0x3c5061(0x13a)]=_0x865b7e,_0x8a7cdc['reactions'][_0x5426d2[_0x3c5061(0x12c)]]=_0x312598,db[_0x3c5061(0x107)]();for(let _0x404f38 of _0x2c458b[_0x3c5061(0x12b)]){inform(_0x404f38,_0x3c5061(0x124),{'conversation_id':_0x2c458b['id'],'message':_0x8a7cdc});}return _0x43808e({'code':_0x3c5061(0xf4),'data':{}});}),_0x5ccd09['on'](_0x24c28f(0x10a),({token:_0x328d57,conversation_id:_0x1121cb,message_id:_0x45c5d8,content:_0x305054},_0xb1f18f)=>{const _0xc4c1c3=_0x24c28f;let _0x4c9f9c=_0x56c64f(_0x328d57);if(!_0x4c9f9c)return _0xb1f18f({'code':_0xc4c1c3(0xe8)});console[_0xc4c1c3(0x143)](_0xc4c1c3(0x10a));let _0x11cab9=data[_0xc4c1c3(0x126)][_0xc4c1c3(0xf3)](_0x59e575=>_0x59e575['id']===_0x1121cb&&_0x59e575[_0xc4c1c3(0x12b)][_0xc4c1c3(0xfe)](_0x4c9f9c[_0xc4c1c3(0x12c)]));if(!_0x11cab9)return _0xb1f18f({'code':_0xc4c1c3(0xe1)});let _0x5823a5=_0x11cab9[_0xc4c1c3(0x123)][_0xc4c1c3(0xf3)](_0x4cc7cb=>_0x4cc7cb['id']===_0x45c5d8&&_0x4cc7cb[_0xc4c1c3(0xeb)]===_0x4c9f9c[_0xc4c1c3(0x12c)]);if(!_0x5823a5)return _0xb1f18f({'code':'NOT_FOUND_MESSAGE'});const _0x39394e=new Date();_0x11cab9[_0xc4c1c3(0x13a)]=_0x39394e,_0x5823a5[_0xc4c1c3(0xe6)]=!![],_0x5823a5[_0xc4c1c3(0x14f)]=_0x305054,db['sync'](),console[_0xc4c1c3(0x143)]('@messageEdited',_0x11cab9[_0xc4c1c3(0x12b)]);for(let _0x2ea979 of _0x11cab9[_0xc4c1c3(0x12b)]){inform(_0x2ea979,'@messageEdited',{'conversation_id':_0x11cab9['id'],'message':_0x5823a5});}return _0xb1f18f({'code':_0xc4c1c3(0xf4),'data':{}});}),_0x5ccd09['on'](_0x24c28f(0x12f),({token:_0x4ccbf4,conversation_id:_0x245bf8,message_id:_0xf139ad,content:_0x52c136},_0x24145c)=>{const _0x53def8=_0x24c28f;let _0x11ddd4=_0x56c64f(_0x4ccbf4);if(!_0x11ddd4)return _0x24145c({'code':'NOT_AUTHENTICATED'});_0x52c136=String(_0x52c136)[_0x53def8(0xe2)]();if(!_0x52c136[_0x53def8(0x14d)])return _0x24145c({'code':_0x53def8(0x150)});let _0xdf6a57=data['conversations'][_0x53def8(0xf3)](_0x31aeab=>_0x31aeab['id']===_0x245bf8&&_0x31aeab[_0x53def8(0x12b)][_0x53def8(0xfe)](_0x11ddd4[_0x53def8(0x12c)]));if(!_0xdf6a57)return _0x24145c({'code':'NOT_FOUND_CONVERSATION'});let _0x5d4408=_0xdf6a57['messages'][_0x53def8(0xf3)](_0x1740ff=>_0x1740ff['id']===_0xf139ad);if(!_0x5d4408)return _0x24145c({'code':_0x53def8(0x14a)});const _0x4f9d77=new Date();let _0x558bff={'id':uuidv4(),'from':_0x11ddd4['username'],'content':_0x52c136,'posted_at':_0x4f9d77,'delivered_to':{[_0x11ddd4['username']]:_0x4f9d77},'reply_to':_0x5d4408,'edited':![],'deleted':![],'reactions':{}};_0xdf6a57[_0x53def8(0x123)][_0x53def8(0x11c)](_0x558bff),_0xdf6a57[_0x53def8(0x13a)]=_0x4f9d77,db[_0x53def8(0x107)]();for(let _0x27139c of _0xdf6a57[_0x53def8(0x12b)]){inform(_0x27139c,_0x53def8(0xf6),{'conversation_id':_0xdf6a57['id'],'message':_0x558bff},()=>{const _0x5dffdc=_0x53def8,_0x33f509=new Date();_0x558bff[_0x5dffdc(0xe7)][_0x27139c]=_0x33f509,db[_0x5dffdc(0x107)]();for(let _0x34684c of _0xdf6a57[_0x5dffdc(0x12b)]){inform(_0x34684c,_0x5dffdc(0x11a),{'conversation_id':_0xdf6a57['id'],'message':_0x558bff});}});}return _0x24145c({'code':_0x53def8(0xf4),'data':{'message':_0x558bff}});}),_0x5ccd09['on'](_0x24c28f(0x13e),({token:_0xa5d15b,conversation_id:_0x4960ee,username:_0xaa52ae},_0x3ba245)=>{const _0x341cb2=_0x24c28f;console[_0x341cb2(0x143)]('@addParticipant',_0x4960ee,_0xaa52ae);let _0x2f4019=_0x56c64f(_0xa5d15b);if(!_0x2f4019)return _0x3ba245({'code':_0x341cb2(0xe8)});let _0x387dfc=data[_0x341cb2(0x126)][_0x341cb2(0xf3)](_0x22207a=>_0x22207a[_0x341cb2(0x12d)]===_0x341cb2(0x10d)&&_0x22207a['id']===_0x4960ee&&_0x22207a[_0x341cb2(0x12b)]['includes'](_0x2f4019[_0x341cb2(0x12c)]));if(!_0x387dfc)return _0x3ba245({'code':'NOT_FOUND_CONVERSATION'});let _0x41a7ff=data[_0x341cb2(0x118)]['find'](_0x12fb58=>_0x12fb58['username']===_0xaa52ae);if(!_0x41a7ff)return _0x3ba245({'code':_0x341cb2(0xf9)});if(!_0x387dfc['participants'][_0x341cb2(0x115)](_0x51f36f=>_0x51f36f===_0xaa52ae)){_0x387dfc['participants'][_0x341cb2(0x11c)](_0xaa52ae),_0x387dfc[_0x341cb2(0xdd)][_0xaa52ae]=-0x1,_0x387dfc[_0x341cb2(0xed)][_0xaa52ae]=new Date(0x0),db[_0x341cb2(0x107)]();for(let _0x3f7b47 of _0x387dfc[_0x341cb2(0x12b)]){inform(_0x3f7b47,_0x341cb2(0xf0),{'conversation':_0x387dfc});}}return _0x3ba245({'code':_0x341cb2(0xf4),'data':{'conversation':_0x387dfc}});}),_0x5ccd09['on'](_0x24c28f(0x14e),({token:_0x2235e9,conversation_id:_0x53848a,username:_0x4509ff},_0x5ae644)=>{const _0x473771=_0x24c28f;console['log'](_0x473771(0x14e),_0x53848a,_0x4509ff);let _0x5223e9=_0x56c64f(_0x2235e9);if(!_0x5223e9)return _0x5ae644({'code':'NOT_AUTHENTICATED'});let _0x1b12dd=data[_0x473771(0x126)]['find'](_0x48ea09=>_0x48ea09[_0x473771(0x12d)]==='many_to_many'&&_0x48ea09[_0x473771(0x12b)][_0x473771(0x14d)]>0x3&&_0x48ea09['id']===_0x53848a&&_0x48ea09[_0x473771(0x12b)][_0x473771(0xfe)](_0x5223e9[_0x473771(0x12c)]));if(!_0x1b12dd)return _0x5ae644({'code':_0x473771(0xe1)});let _0x9b49e7=data[_0x473771(0x118)][_0x473771(0xf3)](_0xd5b80a=>_0xd5b80a[_0x473771(0x12c)]===_0x4509ff);if(!_0x9b49e7)return _0x5ae644({'code':_0x473771(0xf9)});if(_0x1b12dd[_0x473771(0x12b)]['some'](_0x1a9d59=>_0x1a9d59===_0x4509ff)){const _0x3bd7b2=[..._0x1b12dd[_0x473771(0x12b)]];_0x1b12dd[_0x473771(0x12b)]=_0x1b12dd['participants'][_0x473771(0x102)](_0x34c6e2=>_0x34c6e2!==_0x4509ff),delete _0x1b12dd[_0x473771(0xdd)][_0x4509ff],delete _0x1b12dd[_0x473771(0xed)][_0x4509ff],db[_0x473771(0x107)]();for(let _0x337612 of _0x3bd7b2){inform(_0x337612,_0x473771(0xe3),{'conversation':_0x1b12dd});}}return _0x5ae644({'code':_0x473771(0xf4),'data':{'conversation':_0x1b12dd}});}),_0x5ccd09['on']('@deleteMessage',({token:_0x3a4fb0,conversation_id:_0x3ad805,message_id:_0x291873,content:_0x116b00},_0x4d680d)=>{const _0x4ac8d2=_0x24c28f;let _0x4ff55c=_0x56c64f(_0x3a4fb0);if(!_0x4ff55c)return _0x4d680d({'code':_0x4ac8d2(0xe8)});let _0x3f2423=data[_0x4ac8d2(0x126)][_0x4ac8d2(0xf3)](_0x20c36d=>_0x20c36d['id']===_0x3ad805&&_0x20c36d[_0x4ac8d2(0x12b)][_0x4ac8d2(0xfe)](_0x4ff55c[_0x4ac8d2(0x12c)]));if(!_0x3f2423)return _0x4d680d({'code':_0x4ac8d2(0xe1)});let _0x25d470=_0x3f2423[_0x4ac8d2(0x123)]['find'](_0x1b2c01=>_0x1b2c01['id']===_0x291873&&_0x1b2c01[_0x4ac8d2(0xeb)]===_0x4ff55c[_0x4ac8d2(0x12c)]);if(!_0x25d470)return _0x4d680d({'code':_0x4ac8d2(0x14a)});const _0x33d2ab=new Date();_0x3f2423[_0x4ac8d2(0x13a)]=_0x33d2ab,_0x25d470['deleted']=!![],_0x25d470[_0x4ac8d2(0x14f)]=null,db[_0x4ac8d2(0x107)]();for(let _0x1e8277 of _0x3f2423[_0x4ac8d2(0x12b)]){inform(_0x1e8277,_0x4ac8d2(0x11b),{'conversation_id':_0x3f2423['id'],'message_id':_0x25d470['id']});}return _0x4d680d({'code':_0x4ac8d2(0xf4),'data':{}});}),_0x5ccd09['on']('@getConversations',({token:_0x4aa6c0,conversation_id:_0x46306d,message_id:_0xdbdf5f},_0x2f534d)=>{const _0x1266ee=_0x24c28f;let _0xdf71e0=_0x56c64f(_0x4aa6c0);if(!_0xdf71e0)return _0x2f534d({'code':_0x1266ee(0xe8)});_0xdf71e0['last_activity_at']=new Date(),db[_0x1266ee(0x107)]();let _0x42976b=data[_0x1266ee(0x126)][_0x1266ee(0x102)](_0x1ec7c2=>_0x1ec7c2[_0x1266ee(0x12b)][_0x1266ee(0xfe)](_0xdf71e0[_0x1266ee(0x12c)]));return _0x42976b=[..._0x42976b],shuffle(_0x42976b),_0x2f534d({'code':_0x1266ee(0xf4),'data':{'conversations':_0x42976b}});}),_0x5ccd09['on'](_0x24c28f(0x119),({token:_0x5431ac,conversation_id:_0x2e3bf2,message_id:_0x4e79e1,search:_0x2d22bd},_0x117b4c)=>{const _0x67b0fe=_0x24c28f;let _0x1e1936=_0x56c64f(_0x5431ac);if(!_0x1e1936)return _0x117b4c({'code':_0x67b0fe(0xe8)});_0x1e1936[_0x67b0fe(0x133)]=new Date(),db[_0x67b0fe(0x107)](),_0x2d22bd=_0x2d22bd['toLowerCase']();let _0x341062=data[_0x67b0fe(0x126)][_0x67b0fe(0x102)](_0x3c95ee=>_0x3c95ee['participants'][_0x67b0fe(0xfe)](_0x1e1936[_0x67b0fe(0x12c)]))[_0x67b0fe(0x137)](_0x9e3fe0=>({'id':_0x9e3fe0['id'],'type':_0x9e3fe0[_0x67b0fe(0x12d)],'participants':_0x9e3fe0[_0x67b0fe(0x12b)],'updated_at':_0x9e3fe0[_0x67b0fe(0x13a)],'matching_messages':_0x9e3fe0[_0x67b0fe(0x123)][_0x67b0fe(0x102)](_0x5f3753=>(_0x5f3753[_0x67b0fe(0x14f)]||'')[_0x67b0fe(0x132)]()[_0x67b0fe(0xfe)](_0x2d22bd))}))[_0x67b0fe(0x102)](({matching_messages:_0x14a798})=>_0x14a798[_0x67b0fe(0x14d)]>0x0);return _0x341062=[..._0x341062],shuffle(_0x341062),_0x117b4c({'code':_0x67b0fe(0xf4),'data':{'conversations':_0x341062}});}),_0x5ccd09['on'](_0x24c28f(0x13f),({token:_0x248143,conversation_id:_0x4135c1},_0x450db9)=>{const _0x25f302=_0x24c28f;console[_0x25f302(0x143)]('@typeConversation',_0x4135c1);let _0x4f9de5=_0x56c64f(_0x248143);if(!_0x4f9de5)return _0x450db9({'code':_0x25f302(0xe8)});let _0x12c650=data[_0x25f302(0x126)][_0x25f302(0xf3)](_0x497b4a=>_0x497b4a['id']===_0x4135c1&&_0x497b4a[_0x25f302(0x12b)][_0x25f302(0xfe)](_0x4f9de5[_0x25f302(0x12c)]));if(!_0x12c650)return _0x450db9({'code':_0x25f302(0xe1)});_0x12c650[_0x25f302(0xed)][_0x4f9de5['username']]=new Date(),db[_0x25f302(0x107)]();for(let _0x4ef4e8 of _0x12c650[_0x25f302(0x12b)]){console['log'](_0x25f302(0x142),_0x12c650['id'],_0x4f9de5[_0x25f302(0x12c)],_0x12c650[_0x25f302(0xed)][_0x4f9de5[_0x25f302(0x12c)]]),inform(_0x4ef4e8,_0x25f302(0x142),{'conversation_id':_0x12c650['id'],'username':_0x4f9de5[_0x25f302(0x12c)],'date':_0x12c650[_0x25f302(0xed)][_0x4f9de5['username']]});}return _0x450db9({'code':_0x25f302(0xf4),'data':{'conversation':_0x12c650}});}),_0x5ccd09['on']('@setConversationTheme',({token:_0x59d9c7,conversation_id:_0x212aa6,theme:_0x4d2a39},_0x369564)=>{const _0x3f698d=_0x24c28f;console[_0x3f698d(0x143)](_0x3f698d(0xdc),_0x212aa6,_0x4d2a39);let _0x11d694=_0x56c64f(_0x59d9c7);if(!_0x11d694)return _0x369564({'code':_0x3f698d(0xe8)});let _0x288ef2=data[_0x3f698d(0x126)]['find'](_0x474c74=>_0x474c74['id']===_0x212aa6&&_0x474c74[_0x3f698d(0x12b)][_0x3f698d(0xfe)](_0x11d694[_0x3f698d(0x12c)]));if(!_0x288ef2)return _0x369564({'code':_0x3f698d(0xe1)});if(![_0x3f698d(0x144),_0x3f698d(0x130),_0x3f698d(0x12e)][_0x3f698d(0xfe)](_0x4d2a39))return _0x369564({'code':_0x3f698d(0x10c)});_0x288ef2[_0x3f698d(0xde)]=_0x4d2a39,db[_0x3f698d(0x107)]();for(let _0x6c8ea1 of _0x288ef2[_0x3f698d(0x12b)]){inform(_0x6c8ea1,_0x3f698d(0xfb),{'conversation_id':_0x288ef2['id'],'theme':_0x4d2a39});}return _0x369564({'code':'SUCCESS','data':{'conversation':_0x288ef2}});}),_0x5ccd09['on']('@setConversationTitle',({token:_0x460345,conversation_id:_0x5632a1,title:_0xf5718b},_0x257e44)=>{const _0x7edd55=_0x24c28f;console[_0x7edd55(0x143)](_0x7edd55(0x139),_0x5632a1,_0xf5718b);let _0x1bc369=_0x56c64f(_0x460345);if(!_0x1bc369)return _0x257e44({'code':'NOT_AUTHENTICATED'});let _0x5e8392=data['conversations'][_0x7edd55(0xf3)](_0x4dbe69=>_0x4dbe69['id']===_0x5632a1&&_0x4dbe69['participants'][_0x7edd55(0xfe)](_0x1bc369[_0x7edd55(0x12c)]));if(!_0x5e8392)return _0x257e44({'code':'NOT_FOUND_CONVERSATION'});_0x5e8392['title']=_0xf5718b,db[_0x7edd55(0x107)]();for(let _0x1ed95f of _0x5e8392[_0x7edd55(0x12b)]){inform(_0x1ed95f,_0x7edd55(0x138),{'conversation_id':_0x5e8392['id'],'title':_0xf5718b});}return _0x257e44({'code':_0x7edd55(0xf4),'data':{'conversation':_0x5e8392}});}),_0x5ccd09['on'](_0x24c28f(0x106),({token:_0x186b7f,conversation_id:_0x4c7c62,participant:_0x54cbaa,nickname:_0x59ba6b},_0x343ac5)=>{const _0x239b05=_0x24c28f;console[_0x239b05(0x143)]('@setParticipantNickname',_0x4c7c62,_0x54cbaa,_0x59ba6b);let _0x56d502=_0x56c64f(_0x186b7f);if(!_0x56d502)return _0x343ac5({'code':_0x239b05(0xe8)});let _0x42073d=data[_0x239b05(0x126)][_0x239b05(0xf3)](_0x4ae523=>_0x4ae523['id']===_0x4c7c62&&_0x4ae523[_0x239b05(0x12b)][_0x239b05(0xfe)](_0x56d502['username']));if(!_0x42073d)return _0x343ac5({'code':_0x239b05(0xe1)});if(!_0x42073d['participants'][_0x239b05(0xfe)](_0x54cbaa))return _0x343ac5({'code':_0x239b05(0xdb)});_0x42073d[_0x239b05(0x111)][_0x54cbaa]=_0x59ba6b,db[_0x239b05(0x107)]();for(let _0x1fbb80 of _0x42073d[_0x239b05(0x12b)]){console[_0x239b05(0x143)](_0x239b05(0xfc),_0x42073d['id'],_0x54cbaa,_0x59ba6b),inform(_0x1fbb80,_0x239b05(0xfc),{'conversation_id':_0x42073d['id'],'participant':_0x54cbaa,'nickname':_0x59ba6b});}return _0x343ac5({'code':_0x239b05(0xf4),'data':{'conversation':_0x42073d}});});}),http[_0x27bfd3(0x11f)](process[_0x27bfd3(0x140)]['PORT']||0xbb8,()=>{const _0x40f7e7=_0x27bfd3;console[_0x40f7e7(0x143)](_0x40f7e7(0x105)+(process[_0x40f7e7(0x140)][_0x40f7e7(0x121)]||0xbb8));});