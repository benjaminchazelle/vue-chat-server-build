const _0x46ebf8=_0x43bd;function _0x43bd(_0x7efb9,_0x150634){const _0x5e7fe=_0x5e7f();return _0x43bd=function(_0x43bd9b,_0x197cd4){_0x43bd9b=_0x43bd9b-0x127;let _0x514dd6=_0x5e7fe[_0x43bd9b];return _0x514dd6;},_0x43bd(_0x7efb9,_0x150634);}(function(_0x586fb8,_0x2ebd9e){const _0x5a9627=_0x43bd,_0x2be669=_0x586fb8();while(!![]){try{const _0x3f0bc5=-parseInt(_0x5a9627(0x171))/0x1*(-parseInt(_0x5a9627(0x140))/0x2)+-parseInt(_0x5a9627(0x151))/0x3+parseInt(_0x5a9627(0x12f))/0x4+-parseInt(_0x5a9627(0x16c))/0x5*(-parseInt(_0x5a9627(0x174))/0x6)+parseInt(_0x5a9627(0x192))/0x7*(parseInt(_0x5a9627(0x165))/0x8)+parseInt(_0x5a9627(0x19a))/0x9+parseInt(_0x5a9627(0x143))/0xa*(-parseInt(_0x5a9627(0x188))/0xb);if(_0x3f0bc5===_0x2ebd9e)break;else _0x2be669['push'](_0x2be669['shift']());}catch(_0x3af59d){_0x2be669['push'](_0x2be669['shift']());}}}(_0x5e7f,0xcfd1f));const express=require(_0x46ebf8(0x18f)),app=express(),http=require(_0x46ebf8(0x154))[_0x46ebf8(0x14c)](app),io=require(_0x46ebf8(0x152))(http,{'cors':{'origin':'*'}}),DB=require(_0x46ebf8(0x16b)),shuffle=require(_0x46ebf8(0x131)),pickPicture=require(_0x46ebf8(0x133)),{v4:uuidv4}=require(_0x46ebf8(0x195));app['use'](express[_0x46ebf8(0x176)](_0x46ebf8(0x12e)));let db=new DB({'sessions':[],'users':[],'conversations':[]}),data=db[_0x46ebf8(0x166)];db[_0x46ebf8(0x162)](),app[_0x46ebf8(0x17d)]('/',(_0xc7a746,_0x274e63)=>{const _0x1160d6=_0x46ebf8;_0x274e63[_0x1160d6(0x158)](JSON[_0x1160d6(0x163)](data,null,0x4));});let sockets={};function getUserByUsername(_0x329a2c){const _0x3784c9=_0x46ebf8;return data[_0x3784c9(0x18a)][_0x3784c9(0x170)](_0x256472=>_0x256472[_0x3784c9(0x167)]===_0x329a2c);}function _0x5e7f(){const _0x498667=['@alive','keys','user_username','@seeConversation','Server\x20is\x20listening\x20=D','@getOrCreateOneToOneConversation','length','11PdcagY','filter','users','SUCCESS','@messageReacted','@reactMessage','expire_at','express','@addParticipant','deleted','24899IVhUfu','many_to_many','participants','uuid','NOT_FOUND_CONVERSATION','@messageDelivered','conversations','env','739233nMjROr','@participantRemoved','@setConversationTheme','inform','password','content','@authenticate','updated_at','public','1761440JHekLY','from','./shuffle.js','@postMessage','./picture.js','toLowerCase','connection','@deleteMessage','@participantNicknameSet','NOT_FOUND_USER','some','token','@removeParticipant','BLUE','getOrCreateOneToOneConversation','NOT_VALID_USERNAMES','@createManyToManyConversation','452554AQJasQ','includes','@setConversationTitle','33478150UjOQnZ','@messagePosted','one_to_one','@conversationCreated','@conversationSeen','nicknames','NOT_VALID_USER','NOT_VALID_USERNAME','NOT_VALID_PASSWORD','createServer','push','socket@connect','typing','SAD','2405202DyJRrJ','socket.io','@userCreated','http','last_activity_at','@searchMessage','type','send','sessions','@usersAvailable','HAPPY','picture_url','NOT_FOUND_MESSAGE','@conversationTyped','seen','now','@messageEdited','sync','stringify','log','2704PqhMpb','data','username','map','NOT_VALID_CONTENT','HEART','./db.js','5KaJYKg','@getUsers','@editMessage','@messageDeleted','find','7UThBix','random','trim','10152468AoTwTt','isArray','static','messages','socket@authenticate','THUMB','createManyToManyConversation','NOT_AUTHENTICATED','@conversationThemeSet','get','RAINBOW','delivered_to','PORT'];_0x5e7f=function(){return _0x498667;};return _0x5e7f();}function inform(_0x4ad9b0,_0x5489ff,_0x49f6d5,_0x3d5fa5=()=>{}){const _0xb3c46=_0x46ebf8;let _0x30c003=data[_0xb3c46(0x159)][_0xb3c46(0x189)](_0x848feb=>_0x848feb[_0xb3c46(0x183)]===_0x4ad9b0),_0x34b179=_0x30c003[_0xb3c46(0x168)](_0x1d2cf5=>_0x1d2cf5['socket_id']),_0x24c4ab=_0x34b179['map'](_0x28fce5=>sockets[_0x28fce5])['filter'](_0x5dc42f=>_0x5dc42f);if(_0x5489ff==='@messageDeleted')console[_0xb3c46(0x164)](_0x5489ff,_0x4ad9b0,_0x34b179,Object[_0xb3c46(0x182)](sockets));for(let _0x460db9 of _0x24c4ab){try{if(_0x5489ff===_0xb3c46(0x16f))console[_0xb3c46(0x164)](_0xb3c46(0x129),_0x4ad9b0,_0x5489ff,_0x49f6d5);_0x460db9['emit'](_0x5489ff,_0x49f6d5,_0x3d5fa5);}catch(_0x2c4d14){}}}let activeUsers=[];function isUserAwake(_0x22c54d){const _0x5b82f5=_0x46ebf8;return new Date(Date['now']()-0x4e20)<new Date(_0x22c54d[_0x5b82f5(0x155)]);}setInterval(()=>{const _0x5d4e8f=_0x46ebf8;inform('a',_0x5d4e8f(0x181),{'time':Date[_0x5d4e8f(0x160)]()});},0x7d0),setInterval(()=>{const _0xb41780=_0x46ebf8;let _0x22f333=data[_0xb41780(0x18a)][_0xb41780(0x189)](_0x515b96=>isUserAwake(_0x515b96))[_0xb41780(0x168)](_0x19cedd=>_0x19cedd[_0xb41780(0x167)]),_0x54eb5b=_0x22f333[_0xb41780(0x189)](_0xaa7704=>!activeUsers[_0xb41780(0x141)](_0xaa7704)),_0x2914bf=activeUsers['filter'](_0x17fd05=>!_0x22f333['includes'](_0x17fd05));if(_0x54eb5b[_0xb41780(0x187)]>0x0||_0x2914bf[_0xb41780(0x187)]>0x0)for(let _0x131c0f of data['users']){inform(_0x131c0f['username'],_0xb41780(0x15a),{'usernames':_0x22f333});}activeUsers=_0x22f333;},0x3e8),io['on'](_0x46ebf8(0x135),_0x108b8d=>{const _0x4ed088=_0x46ebf8;sockets[_0x108b8d['id']]=_0x108b8d;function _0x52d1a4(_0x439c14){const _0x183af7=_0x43bd;let _0x1731a0=data[_0x183af7(0x159)][_0x183af7(0x170)](_0x13ff4b=>_0x13ff4b[_0x183af7(0x13a)]===_0x439c14);data[_0x183af7(0x159)]=data['sessions'][_0x183af7(0x189)](_0x5e57db=>new Date()<new Date(_0x5e57db[_0x183af7(0x18e)]));let _0x4683cd=data[_0x183af7(0x159)][_0x183af7(0x170)](_0xf1cada=>_0xf1cada['token']===_0x439c14);if(_0x4683cd)return getUserByUsername(_0x4683cd['user_username']);return undefined;}console['log'](_0x4ed088(0x14e),_0x108b8d['id']),_0x108b8d['on'](_0x4ed088(0x12c),({username:_0xf8dca7,password:_0x249ef2},_0x19bf17)=>{const _0x1a2716=_0x4ed088;console['log'](_0x1a2716(0x178),_0x108b8d['id'],_0xf8dca7,_0x249ef2);let _0x1b43bd=Date['now']()+String(Math[_0x1a2716(0x172)]()),_0x232b17={'token':_0x1b43bd,'socket_id':_0x108b8d['id'],'user_username':_0xf8dca7,'expire_at':new Date(Date[_0x1a2716(0x160)]()+0x18*0x3c*0x3c*0x3e8)},_0x354b2b=data['users']['find'](_0x1f97ff=>_0x1f97ff[_0x1a2716(0x167)]===_0xf8dca7);if(_0x354b2b){if(_0x354b2b[_0x1a2716(0x12a)]!==_0x249ef2)return _0x19bf17({'code':_0x1a2716(0x17b)});return data['sessions']['push'](_0x232b17),console['log']({'newSession':_0x232b17}),db[_0x1a2716(0x162)](),_0x19bf17({'code':'SUCCESS','data':{'username':_0xf8dca7,'token':_0x232b17[_0x1a2716(0x13a)],'picture_url':_0x354b2b[_0x1a2716(0x15c)]}});}if(!_0xf8dca7||_0xf8dca7[_0x1a2716(0x141)]('-'))return _0x19bf17({'code':_0x1a2716(0x14a)});if(!_0x249ef2)return _0x19bf17({'code':_0x1a2716(0x14b)});let _0x27bf1c={'username':_0xf8dca7,'password':_0x249ef2,'picture_url':pickPicture(data[_0x1a2716(0x18a)]),'last_activity_at':new Date()};data[_0x1a2716(0x18a)][_0x1a2716(0x14d)](_0x27bf1c),data[_0x1a2716(0x159)][_0x1a2716(0x14d)](_0x232b17);for(let _0x28566c of data[_0x1a2716(0x18a)]){inform(_0x28566c[_0x1a2716(0x167)],_0x1a2716(0x153),{'user':{..._0x27bf1c,'password':undefined}});}return db[_0x1a2716(0x162)](),_0x19bf17({'code':'SUCCESS','data':{'username':_0xf8dca7,'token':_0x1b43bd,'picture_url':_0x27bf1c[_0x1a2716(0x15c)]}});}),_0x108b8d['on'](_0x4ed088(0x16d),({token:_0x21ab3a},_0x3aa65e)=>{const _0x464177=_0x4ed088;let _0x1b117f=_0x52d1a4(_0x21ab3a);if(!_0x1b117f)return _0x3aa65e({'code':_0x464177(0x17b)});_0x1b117f['last_activity_at']=new Date(),db['sync']();let _0x3d4217=data[_0x464177(0x18a)][_0x464177(0x168)](_0x278c6e=>({'username':_0x278c6e[_0x464177(0x167)],'picture_url':_0x278c6e[_0x464177(0x15c)],'awake':isUserAwake(_0x278c6e)}));return _0x3aa65e({'code':_0x464177(0x18b),'data':{'users':_0x3d4217}});}),_0x108b8d['on'](_0x4ed088(0x186),({token:_0x6ca9f5,username:_0x45644d},_0x329ff7)=>{const _0x5e6fb6=_0x4ed088;console[_0x5e6fb6(0x164)](_0x5e6fb6(0x13d));let _0x528b8e=_0x52d1a4(_0x6ca9f5);if(!_0x528b8e)return _0x329ff7({'code':_0x5e6fb6(0x17b)});_0x528b8e[_0x5e6fb6(0x155)]=new Date(),db['sync']();let _0x4c9d09=getUserByUsername(_0x45644d);if(!_0x4c9d09)return _0x329ff7({'code':_0x5e6fb6(0x138)});let _0x34535e=data[_0x5e6fb6(0x198)]['find'](_0x5deab4=>_0x5deab4[_0x5e6fb6(0x157)]===_0x5e6fb6(0x145)&&_0x5deab4[_0x5e6fb6(0x194)]['length']===0x2&&_0x5deab4[_0x5e6fb6(0x194)][_0x5e6fb6(0x141)](_0x528b8e['username'])&&_0x5deab4[_0x5e6fb6(0x194)]['includes'](_0x4c9d09[_0x5e6fb6(0x167)]));const _0x25b997=new Date();if(!_0x34535e){let _0x111425=[_0x528b8e['username'],_0x4c9d09[_0x5e6fb6(0x167)]],_0x3e3278={};for(let _0x155bc2 of _0x111425){_0x3e3278[_0x155bc2]=-0x1;}_0x34535e={'id':uuidv4(),'type':_0x5e6fb6(0x145),'participants':_0x111425,'messages':[],'title':null,'theme':_0x5e6fb6(0x13c),'nicknames':{},'updated_at':_0x25b997,'seen':_0x3e3278,'typing':{}},data['conversations'][_0x5e6fb6(0x14d)](_0x34535e),db[_0x5e6fb6(0x162)]();for(let _0x35159 of _0x34535e[_0x5e6fb6(0x194)]){inform(_0x35159,_0x5e6fb6(0x146),{'conversation':_0x34535e});}}return _0x329ff7({'code':_0x5e6fb6(0x18b),'data':{'conversation':_0x34535e}});}),_0x108b8d['on'](_0x4ed088(0x13f),({token:_0x399991,usernames:_0x55ff74},_0x1a0baf)=>{const _0x56fec5=_0x4ed088;let _0x110972=_0xadef0b=>setTimeout(_0x3a8f2a=>_0x1a0baf(_0x3a8f2a),0x7d0,_0xadef0b);console['log'](_0x56fec5(0x17a));let _0x24815b=_0x52d1a4(_0x399991);if(!_0x24815b)return _0x110972({'code':_0x56fec5(0x17b)});if(!Array[_0x56fec5(0x175)](_0x55ff74))return _0x110972({'code':_0x56fec5(0x13e)});_0x24815b[_0x56fec5(0x155)]=new Date(),db[_0x56fec5(0x162)](),_0x55ff74=[...new Set([_0x24815b['username'],..._0x55ff74])];if(_0x55ff74[_0x56fec5(0x139)](_0x57763f=>!getUserByUsername(_0x57763f)))return _0x110972({'code':_0x56fec5(0x138)});const _0x1999cd=new Date();let _0x559433={};for(let _0x369ac1 of _0x55ff74){_0x559433[_0x369ac1]=-0x1;}let _0x508eb5={'id':uuidv4(),'type':_0x56fec5(0x193),'participants':_0x55ff74,'messages':[],'title':null,'theme':_0x56fec5(0x13c),'nicknames':{},'seen':_0x559433,'updated_at':_0x1999cd,'typing':{}};data['conversations'][_0x56fec5(0x14d)](_0x508eb5),db[_0x56fec5(0x162)]();for(let _0x4af616 of _0x508eb5[_0x56fec5(0x194)]){inform(_0x4af616,_0x56fec5(0x146),{'conversation':_0x508eb5});}return _0x110972({'code':_0x56fec5(0x18b),'data':{'conversation':_0x508eb5}});}),_0x108b8d['on'](_0x4ed088(0x132),({token:_0xb66b49,conversation_id:_0x147f10,content:_0x2ab9e1},_0xb69de)=>{const _0x9c03ee=_0x4ed088;console[_0x9c03ee(0x164)](_0x9c03ee(0x132));let _0x3fe48c=_0x52d1a4(_0xb66b49);if(!_0x3fe48c)return _0xb69de({'code':'NOT_AUTHENTICATED'});_0x2ab9e1=String(_0x2ab9e1)[_0x9c03ee(0x173)]();if(!_0x2ab9e1[_0x9c03ee(0x187)])return _0xb69de({'code':'NOT_VALID_CONTENT'});_0x3fe48c[_0x9c03ee(0x155)]=new Date(),db[_0x9c03ee(0x162)]();let _0x404404=data[_0x9c03ee(0x198)][_0x9c03ee(0x170)](_0x5e0a63=>_0x5e0a63['id']===_0x147f10&&_0x5e0a63[_0x9c03ee(0x194)]['includes'](_0x3fe48c['username']));if(!_0x404404)return _0xb69de({'code':'NOT_FOUND_CONVERSATION'});const _0x1b7222=new Date(),_0x345f3a=uuidv4();let _0x4e1747={'id':_0x345f3a,'from':_0x3fe48c[_0x9c03ee(0x167)],'content':_0x2ab9e1,'posted_at':_0x1b7222,'delivered_to':{[_0x3fe48c[_0x9c03ee(0x167)]]:_0x1b7222},'reply_to':null,'edited':![],'deleted':![],'reactions':{}};_0x404404['messages'][_0x9c03ee(0x14d)](_0x4e1747),_0x404404[_0x9c03ee(0x12d)]=_0x1b7222,_0x404404[_0x9c03ee(0x15f)][_0x3fe48c['username']]={'message_id':_0x345f3a,'time':_0x1b7222},db[_0x9c03ee(0x162)]();for(let _0x25aec3 of _0x404404[_0x9c03ee(0x194)]){inform(_0x25aec3,_0x9c03ee(0x147),{'conversation':_0x404404});}for(let _0x28d033 of _0x404404[_0x9c03ee(0x194)]){inform(_0x28d033,_0x9c03ee(0x144),{'conversation_id':_0x404404['id'],'message':_0x4e1747},()=>{const _0x219408=_0x9c03ee,_0x593b2a=new Date();_0x4e1747[_0x219408(0x17f)][_0x28d033]=_0x593b2a,db[_0x219408(0x162)]();for(let _0x4427ca of _0x404404['participants']){inform(_0x4427ca,'@messageDelivered',{'conversation_id':_0x404404['id'],'message':_0x4e1747});}});}return _0xb69de({'code':_0x9c03ee(0x18b),'data':{'message':_0x4e1747}});}),_0x108b8d['on'](_0x4ed088(0x184),({token:_0x418182,conversation_id:_0x4ab551,message_id:_0xacdee4},_0x3684b5)=>{const _0x1a1722=_0x4ed088;let _0x1d1a89=_0x52d1a4(_0x418182);if(!_0x1d1a89)return _0x3684b5({'code':_0x1a1722(0x17b)});let _0x3174db=data[_0x1a1722(0x198)]['find'](_0x104eb0=>_0x104eb0['id']===_0x4ab551&&_0x104eb0[_0x1a1722(0x194)][_0x1a1722(0x141)](_0x1d1a89[_0x1a1722(0x167)]));if(!_0x3174db)return _0x3684b5({'code':_0x1a1722(0x196)});let _0x55c3db=_0x3174db[_0x1a1722(0x177)][_0x1a1722(0x170)](_0x33c925=>_0x33c925['id']===_0xacdee4);if(!_0x55c3db)return _0x3684b5({'code':_0x1a1722(0x15d)});const _0x3ccafa=new Date();_0x3174db[_0x1a1722(0x15f)][_0x1d1a89[_0x1a1722(0x167)]]={'message_id':_0xacdee4,'time':_0x3ccafa},db[_0x1a1722(0x162)]();for(let _0x553f80 of _0x3174db['participants']){inform(_0x553f80,_0x1a1722(0x147),{'conversation':_0x3174db});}return _0x3684b5({'code':_0x1a1722(0x18b),'data':{}});}),_0x108b8d['on'](_0x4ed088(0x18d),({token:_0x429afb,conversation_id:_0x35e343,message_id:_0x53f753,reaction:_0x12e6fb},_0x23a718)=>{const _0x2fb840=_0x4ed088;let _0x935f7=_0x52d1a4(_0x429afb);if(!_0x935f7)return _0x23a718({'code':_0x2fb840(0x17b)});let _0x17ecec=data[_0x2fb840(0x198)]['find'](_0x3f4076=>_0x3f4076['id']===_0x35e343&&_0x3f4076['participants']['includes'](_0x935f7['username']));if(!_0x17ecec)return _0x23a718({'code':_0x2fb840(0x196)});let _0x109bf7=_0x17ecec['messages'][_0x2fb840(0x170)](_0x3b39fb=>_0x3b39fb['id']===_0x53f753);if(!_0x109bf7)return _0x23a718({'code':'NOT_FOUND_MESSAGE'});if(![_0x2fb840(0x16a),_0x2fb840(0x179),_0x2fb840(0x15b),_0x2fb840(0x150)][_0x2fb840(0x141)](_0x12e6fb))return _0x23a718({'code':'NOT_FOUND_REACTION'});const _0x37c3dd=new Date();_0x17ecec[_0x2fb840(0x12d)]=_0x37c3dd,_0x109bf7['reactions'][_0x935f7[_0x2fb840(0x167)]]=_0x12e6fb,db[_0x2fb840(0x162)]();for(let _0x36603b of _0x17ecec[_0x2fb840(0x194)]){inform(_0x36603b,_0x2fb840(0x18c),{'conversation_id':_0x17ecec['id'],'message':_0x109bf7});}return _0x23a718({'code':_0x2fb840(0x18b),'data':{}});}),_0x108b8d['on'](_0x4ed088(0x16e),({token:_0x291306,conversation_id:_0x538724,message_id:_0x479033,content:_0x57f0e5},_0x3ee333)=>{const _0x5957f2=_0x4ed088;let _0x2ad8d6=_0x52d1a4(_0x291306);if(!_0x2ad8d6)return _0x3ee333({'code':_0x5957f2(0x17b)});console['log'](_0x5957f2(0x16e));let _0xf84caa=data[_0x5957f2(0x198)][_0x5957f2(0x170)](_0x112fc7=>_0x112fc7['id']===_0x538724&&_0x112fc7[_0x5957f2(0x194)]['includes'](_0x2ad8d6[_0x5957f2(0x167)]));if(!_0xf84caa)return _0x3ee333({'code':_0x5957f2(0x196)});let _0x53b80f=_0xf84caa[_0x5957f2(0x177)][_0x5957f2(0x170)](_0xd633c1=>_0xd633c1['id']===_0x479033&&_0xd633c1['from']===_0x2ad8d6[_0x5957f2(0x167)]);if(!_0x53b80f)return _0x3ee333({'code':_0x5957f2(0x15d)});const _0x1be7ca=new Date();_0xf84caa[_0x5957f2(0x12d)]=_0x1be7ca,_0x53b80f['edited']=!![],_0x53b80f[_0x5957f2(0x12b)]=_0x57f0e5,db[_0x5957f2(0x162)](),console[_0x5957f2(0x164)](_0x5957f2(0x161),_0xf84caa[_0x5957f2(0x194)]);for(let _0x4421b6 of _0xf84caa[_0x5957f2(0x194)]){inform(_0x4421b6,_0x5957f2(0x161),{'conversation_id':_0xf84caa['id'],'message':_0x53b80f});}return _0x3ee333({'code':_0x5957f2(0x18b),'data':{}});}),_0x108b8d['on']('@replyMessage',({token:_0x3780c1,conversation_id:_0x5f4e85,message_id:_0x460d97,content:_0x303b80},_0x4f34f1)=>{const _0x3e842f=_0x4ed088;let _0x355fb9=_0x52d1a4(_0x3780c1);if(!_0x355fb9)return _0x4f34f1({'code':_0x3e842f(0x17b)});_0x303b80=String(_0x303b80)[_0x3e842f(0x173)]();if(!_0x303b80[_0x3e842f(0x187)])return _0x4f34f1({'code':_0x3e842f(0x169)});let _0x578af3=data['conversations'][_0x3e842f(0x170)](_0x18444d=>_0x18444d['id']===_0x5f4e85&&_0x18444d[_0x3e842f(0x194)][_0x3e842f(0x141)](_0x355fb9[_0x3e842f(0x167)]));if(!_0x578af3)return _0x4f34f1({'code':_0x3e842f(0x196)});let _0x5d47d9=_0x578af3[_0x3e842f(0x177)]['find'](_0x5ce721=>_0x5ce721['id']===_0x460d97);if(!_0x5d47d9)return _0x4f34f1({'code':_0x3e842f(0x15d)});const _0x38b66a=new Date();let _0x4d3beb={'id':uuidv4(),'from':_0x355fb9[_0x3e842f(0x167)],'content':_0x303b80,'posted_at':_0x38b66a,'delivered_to':{[_0x355fb9['username']]:_0x38b66a},'reply_to':_0x5d47d9,'edited':![],'deleted':![],'reactions':{}};_0x578af3[_0x3e842f(0x177)]['push'](_0x4d3beb),_0x578af3[_0x3e842f(0x12d)]=_0x38b66a,db[_0x3e842f(0x162)]();for(let _0xba0b1d of _0x578af3[_0x3e842f(0x194)]){inform(_0xba0b1d,_0x3e842f(0x144),{'conversation_id':_0x578af3['id'],'message':_0x4d3beb},()=>{const _0x304cd2=_0x3e842f,_0x46baa5=new Date();_0x4d3beb[_0x304cd2(0x17f)][_0xba0b1d]=_0x46baa5,db[_0x304cd2(0x162)]();for(let _0x2c1cf6 of _0x578af3[_0x304cd2(0x194)]){inform(_0x2c1cf6,_0x304cd2(0x197),{'conversation_id':_0x578af3['id'],'message':_0x4d3beb});}});}return _0x4f34f1({'code':'SUCCESS','data':{'message':_0x4d3beb}});}),_0x108b8d['on'](_0x4ed088(0x190),({token:_0x3fc7a5,conversation_id:_0x54250a,username:_0x5239f2},_0x3ea942)=>{const _0x1cf73b=_0x4ed088;console[_0x1cf73b(0x164)](_0x1cf73b(0x190),_0x54250a,_0x5239f2);let _0x455457=_0x52d1a4(_0x3fc7a5);if(!_0x455457)return _0x3ea942({'code':_0x1cf73b(0x17b)});let _0x37930a=data[_0x1cf73b(0x198)][_0x1cf73b(0x170)](_0x15469c=>_0x15469c[_0x1cf73b(0x157)]===_0x1cf73b(0x193)&&_0x15469c['id']===_0x54250a&&_0x15469c[_0x1cf73b(0x194)]['includes'](_0x455457[_0x1cf73b(0x167)]));if(!_0x37930a)return _0x3ea942({'code':'NOT_FOUND_CONVERSATION'});let _0x401f31=data[_0x1cf73b(0x18a)]['find'](_0x5ce716=>_0x5ce716[_0x1cf73b(0x167)]===_0x5239f2);if(!_0x401f31)return _0x3ea942({'code':_0x1cf73b(0x149)});if(!_0x37930a[_0x1cf73b(0x194)][_0x1cf73b(0x139)](_0x2a7cfb=>_0x2a7cfb===_0x5239f2)){_0x37930a[_0x1cf73b(0x194)][_0x1cf73b(0x14d)](_0x5239f2),_0x37930a[_0x1cf73b(0x15f)][_0x5239f2]=-0x1,_0x37930a[_0x1cf73b(0x14f)][_0x5239f2]=new Date(0x0),db[_0x1cf73b(0x162)]();for(let _0x9e5731 of _0x37930a[_0x1cf73b(0x194)]){inform(_0x9e5731,'@participantAdded',{'conversation':_0x37930a});}}return _0x3ea942({'code':'SUCCESS','data':{'conversation':_0x37930a}});}),_0x108b8d['on'](_0x4ed088(0x13b),({token:_0x14a640,conversation_id:_0x9cd842,username:_0x4f85c0},_0x157bc)=>{const _0x362a72=_0x4ed088;console[_0x362a72(0x164)](_0x362a72(0x13b),_0x9cd842,_0x4f85c0);let _0x4bc0a3=_0x52d1a4(_0x14a640);if(!_0x4bc0a3)return _0x157bc({'code':_0x362a72(0x17b)});let _0x3f9e6d=data['conversations']['find'](_0x17a50f=>_0x17a50f[_0x362a72(0x157)]==='many_to_many'&&_0x17a50f[_0x362a72(0x194)]['length']>0x3&&_0x17a50f['id']===_0x9cd842&&_0x17a50f[_0x362a72(0x194)][_0x362a72(0x141)](_0x4bc0a3['username']));if(!_0x3f9e6d)return _0x157bc({'code':'NOT_FOUND_CONVERSATION'});let _0x27bceb=data[_0x362a72(0x18a)][_0x362a72(0x170)](_0xe8544f=>_0xe8544f['username']===_0x4f85c0);if(!_0x27bceb)return _0x157bc({'code':_0x362a72(0x149)});if(_0x3f9e6d['participants'][_0x362a72(0x139)](_0x180c0b=>_0x180c0b===_0x4f85c0)){const _0x1acc2a=[..._0x3f9e6d[_0x362a72(0x194)]];_0x3f9e6d[_0x362a72(0x194)]=_0x3f9e6d['participants'][_0x362a72(0x189)](_0x3e1b8f=>_0x3e1b8f!==_0x4f85c0),delete _0x3f9e6d[_0x362a72(0x15f)][_0x4f85c0],delete _0x3f9e6d[_0x362a72(0x14f)][_0x4f85c0],db[_0x362a72(0x162)]();for(let _0x31080e of _0x1acc2a){inform(_0x31080e,_0x362a72(0x127),{'conversation':_0x3f9e6d});}}return _0x157bc({'code':'SUCCESS','data':{'conversation':_0x3f9e6d}});}),_0x108b8d['on'](_0x4ed088(0x136),({token:_0x5e6730,conversation_id:_0x2dfb2a,message_id:_0x3bd901,content:_0x586f71},_0x2509b)=>{const _0x353fe4=_0x4ed088;let _0x2bad04=_0x52d1a4(_0x5e6730);if(!_0x2bad04)return _0x2509b({'code':_0x353fe4(0x17b)});let _0x5e815f=data['conversations'][_0x353fe4(0x170)](_0x473ab2=>_0x473ab2['id']===_0x2dfb2a&&_0x473ab2[_0x353fe4(0x194)]['includes'](_0x2bad04['username']));if(!_0x5e815f)return _0x2509b({'code':_0x353fe4(0x196)});let _0x5a9789=_0x5e815f['messages']['find'](_0x1918d6=>_0x1918d6['id']===_0x3bd901&&_0x1918d6[_0x353fe4(0x130)]===_0x2bad04[_0x353fe4(0x167)]);if(!_0x5a9789)return _0x2509b({'code':_0x353fe4(0x15d)});const _0x3e0fd1=new Date();_0x5e815f[_0x353fe4(0x12d)]=_0x3e0fd1,_0x5a9789[_0x353fe4(0x191)]=!![],_0x5a9789[_0x353fe4(0x12b)]=null,db[_0x353fe4(0x162)]();for(let _0x388d1b of _0x5e815f[_0x353fe4(0x194)]){inform(_0x388d1b,_0x353fe4(0x16f),{'conversation_id':_0x5e815f['id'],'message_id':_0x5a9789['id']});}return _0x2509b({'code':_0x353fe4(0x18b),'data':{}});}),_0x108b8d['on']('@getConversations',({token:_0x1c89f9,conversation_id:_0x25a852,message_id:_0x318c75},_0x223417)=>{const _0xdb6ee7=_0x4ed088;let _0x289d12=_0x52d1a4(_0x1c89f9);if(!_0x289d12)return _0x223417({'code':_0xdb6ee7(0x17b)});_0x289d12[_0xdb6ee7(0x155)]=new Date(),db['sync']();let _0x1797bf=data[_0xdb6ee7(0x198)]['filter'](_0x2f480e=>_0x2f480e[_0xdb6ee7(0x194)][_0xdb6ee7(0x141)](_0x289d12[_0xdb6ee7(0x167)]));return _0x1797bf=[..._0x1797bf],shuffle(_0x1797bf),_0x223417({'code':_0xdb6ee7(0x18b),'data':{'conversations':_0x1797bf}});}),_0x108b8d['on'](_0x4ed088(0x156),({token:_0xb976c4,conversation_id:_0x57ab64,message_id:_0x4c7d35,search:_0x4d029c},_0x625776)=>{const _0x5bf063=_0x4ed088;let _0x218624=_0x52d1a4(_0xb976c4);if(!_0x218624)return _0x625776({'code':_0x5bf063(0x17b)});_0x218624['last_activity_at']=new Date(),db[_0x5bf063(0x162)](),_0x4d029c=_0x4d029c[_0x5bf063(0x134)]();let _0x403fad=data[_0x5bf063(0x198)][_0x5bf063(0x189)](_0x207f0e=>_0x207f0e[_0x5bf063(0x194)][_0x5bf063(0x141)](_0x218624[_0x5bf063(0x167)]))[_0x5bf063(0x168)](_0x2067ab=>({'id':_0x2067ab['id'],'type':_0x2067ab['type'],'participants':_0x2067ab['participants'],'updated_at':_0x2067ab[_0x5bf063(0x12d)],'matching_messages':_0x2067ab[_0x5bf063(0x177)][_0x5bf063(0x189)](_0x55f1d3=>(_0x55f1d3[_0x5bf063(0x12b)]||'')['toLowerCase']()[_0x5bf063(0x141)](_0x4d029c))}))['filter'](({matching_messages:_0x499224})=>_0x499224[_0x5bf063(0x187)]>0x0);return _0x403fad=[..._0x403fad],shuffle(_0x403fad),_0x625776({'code':_0x5bf063(0x18b),'data':{'conversations':_0x403fad}});}),_0x108b8d['on']('@typeConversation',({token:_0x551e01,conversation_id:_0x53f7df},_0x27f1cf)=>{const _0x29273d=_0x4ed088;console[_0x29273d(0x164)]('@typeConversation',_0x53f7df);let _0x40b247=_0x52d1a4(_0x551e01);if(!_0x40b247)return _0x27f1cf({'code':'NOT_AUTHENTICATED'});let _0x57c8cd=data[_0x29273d(0x198)][_0x29273d(0x170)](_0x30aac2=>_0x30aac2['id']===_0x53f7df&&_0x30aac2['participants'][_0x29273d(0x141)](_0x40b247[_0x29273d(0x167)]));if(!_0x57c8cd)return _0x27f1cf({'code':_0x29273d(0x196)});_0x57c8cd['typing'][_0x40b247[_0x29273d(0x167)]]=new Date(),db[_0x29273d(0x162)]();for(let _0x1ef554 of _0x57c8cd[_0x29273d(0x194)]){console[_0x29273d(0x164)](_0x29273d(0x15e),_0x57c8cd['id'],_0x40b247['username'],_0x57c8cd[_0x29273d(0x14f)][_0x40b247['username']]),inform(_0x1ef554,_0x29273d(0x15e),{'conversation_id':_0x57c8cd['id'],'username':_0x40b247['username'],'date':_0x57c8cd[_0x29273d(0x14f)][_0x40b247[_0x29273d(0x167)]]});}return _0x27f1cf({'code':'SUCCESS','data':{'conversation':_0x57c8cd}});}),_0x108b8d['on'](_0x4ed088(0x128),({token:_0x58de2c,conversation_id:_0x227a28,theme:_0x40f42c},_0x1986d1)=>{const _0x131e20=_0x4ed088;console['log'](_0x131e20(0x128),_0x227a28,_0x40f42c);let _0x5e50c3=_0x52d1a4(_0x58de2c);if(!_0x5e50c3)return _0x1986d1({'code':_0x131e20(0x17b)});let _0x5c5c4f=data[_0x131e20(0x198)][_0x131e20(0x170)](_0x27d7e6=>_0x27d7e6['id']===_0x227a28&&_0x27d7e6[_0x131e20(0x194)]['includes'](_0x5e50c3['username']));if(!_0x5c5c4f)return _0x1986d1({'code':_0x131e20(0x196)});if(!['BLUE','RED',_0x131e20(0x17e)][_0x131e20(0x141)](_0x40f42c))return _0x1986d1({'code':'NOT_FOUND_THEME'});_0x5c5c4f['theme']=_0x40f42c,db[_0x131e20(0x162)]();for(let _0x46ef2c of _0x5c5c4f['participants']){inform(_0x46ef2c,_0x131e20(0x17c),{'conversation_id':_0x5c5c4f['id'],'theme':_0x40f42c});}return _0x1986d1({'code':'SUCCESS','data':{'conversation':_0x5c5c4f}});}),_0x108b8d['on'](_0x4ed088(0x142),({token:_0x56693d,conversation_id:_0x143b2b,title:_0x4ab512},_0x56a0ec)=>{const _0x132e73=_0x4ed088;console[_0x132e73(0x164)](_0x132e73(0x142),_0x143b2b,_0x4ab512);let _0x18c37f=_0x52d1a4(_0x56693d);if(!_0x18c37f)return _0x56a0ec({'code':_0x132e73(0x17b)});let _0x37c378=data[_0x132e73(0x198)]['find'](_0x342682=>_0x342682['id']===_0x143b2b&&_0x342682['participants'][_0x132e73(0x141)](_0x18c37f[_0x132e73(0x167)]));if(!_0x37c378)return _0x56a0ec({'code':_0x132e73(0x196)});_0x37c378['title']=_0x4ab512,db[_0x132e73(0x162)]();for(let _0x4aea9a of _0x37c378[_0x132e73(0x194)]){inform(_0x4aea9a,'@conversationTitleSet',{'conversation_id':_0x37c378['id'],'title':_0x4ab512});}return _0x56a0ec({'code':_0x132e73(0x18b),'data':{'conversation':_0x37c378}});}),_0x108b8d['on']('@setParticipantNickname',({token:_0x2141e2,conversation_id:_0x53fb21,participant:_0x3ca51a,nickname:_0x4107e0},_0x15c651)=>{const _0x2720e3=_0x4ed088;console[_0x2720e3(0x164)]('@setParticipantNickname',_0x53fb21,_0x3ca51a,_0x4107e0);let _0x28b518=_0x52d1a4(_0x2141e2);if(!_0x28b518)return _0x15c651({'code':'NOT_AUTHENTICATED'});let _0x17eb99=data[_0x2720e3(0x198)][_0x2720e3(0x170)](_0x5e746d=>_0x5e746d['id']===_0x53fb21&&_0x5e746d[_0x2720e3(0x194)][_0x2720e3(0x141)](_0x28b518[_0x2720e3(0x167)]));if(!_0x17eb99)return _0x15c651({'code':_0x2720e3(0x196)});if(!_0x17eb99[_0x2720e3(0x194)][_0x2720e3(0x141)](_0x3ca51a))return _0x15c651({'code':'NOT_FOUND_PARTICIPANT'});_0x17eb99[_0x2720e3(0x148)][_0x3ca51a]=_0x4107e0,db[_0x2720e3(0x162)]();for(let _0x4a092f of _0x17eb99[_0x2720e3(0x194)]){console[_0x2720e3(0x164)](_0x2720e3(0x137),_0x17eb99['id'],_0x3ca51a,_0x4107e0),inform(_0x4a092f,_0x2720e3(0x137),{'conversation_id':_0x17eb99['id'],'participant':_0x3ca51a,'nickname':_0x4107e0});}return _0x15c651({'code':'SUCCESS','data':{'conversation':_0x17eb99}});});}),http['listen'](process[_0x46ebf8(0x199)][_0x46ebf8(0x180)],()=>{const _0x2f896=_0x46ebf8;console['log'](_0x2f896(0x185));});